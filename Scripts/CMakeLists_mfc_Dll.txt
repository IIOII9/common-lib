# =======================================================
# MyMfcDll – MFC Extension DLL
# =======================================================

set(TARGET_NAME MyMfcDll)

# ------------------------------
# 指定源码目录
# ------------------------------
set(SRC_DIR "${CMAKE_SOURCE_DIR}/../MFCApplication16")

# ------------------------------
# 递归获取所有源文件
# ------------------------------
file(GLOB_RECURSE CPP_FILES "${SRC_DIR}/*.cpp")
file(GLOB_RECURSE H_FILES   "${SRC_DIR}/*.h")
file(GLOB_RECURSE RC_FILES  "${SRC_DIR}/*.rc")

if(NOT CPP_FILES)
    message(FATAL_ERROR "No source files found in ${SRC_DIR}")
endif()

# ------------------------------
# 创建 MFC DLL
# ------------------------------
add_library(${TARGET_NAME} SHARED
    ${CPP_FILES}
    ${H_FILES}
    ${RC_FILES}
)

# VS 分组（按真实目录）
source_group(TREE ${SRC_DIR} FILES
    ${CPP_FILES}
    ${H_FILES}
    ${RC_FILES}
)

# include
target_include_directories(${TARGET_NAME} PRIVATE
    ${SRC_DIR}
)

# MFC 预编译头
target_precompile_headers(${TARGET_NAME} PRIVATE
    "${SRC_DIR}/pch.h"
)

# 套用根目录提供的 MFC 配置
configure_mfc_dll(${TARGET_NAME})
